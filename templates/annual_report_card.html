<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ t.report_title }}</title>
  <style>
    @page {
      size: A4;
      margin: 0cm;
    }

    body {
      font-family: Arial, sans-serif;
      font-size: 10px;
      margin-top: 15px;
      margin-left: 30px;
      margin-right: 30px;
      margin-bottom: 10px;
    }

    .page {
      page-break-after: always;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
    }

    .header-left,
    .header-right {
      width: 50%;
      font-size: 11px;
      text-align: center;
      line-height: 1.3;
    }

    .header-logo {
      width: 100px;
      text-align: center;
    }

    .header-logo img {
      max-width: 80px;
      max-height: 80px;
    }

    .title {
      text-align: center;
      font-size: 11px;
      margin: 5px 0;
    }

    .form-container {
      display: flex;
      margin-top: 5px;
    }

    .photo-box {
      width: 90px;
      height: 100px;
      border: 1px solid black;
      text-align: center;
      font-size: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .form-table {
      width: 100%;
      padding-left: 10px;
    }

    .form-table td {
      font-size: 11px;
      padding: 2px 3px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 5px;
    }

    th, td {
      border: 1px solid black;
      padding: 3px;
      text-align: center;
      font-size: 10px;
/*      background-color: #808080;*/
    }

    th{
      background-color: #666;
    }

    .summary-table td {
      padding: 3px;
      font-size: 10px;
      white-space: nowrap;
    }

    .subject {
      text-align: left;
    }

    .subject-m {
      font-size: 10px;
      text-align: left;
      font-style: italic;
      color: #666;
    }

    .footer {
      margin-top: 8px;
      font-size: 10px;
    }

    .tg-0pky {
      text-align: left;
    }
  </style>
</head>
<body>
  {% for student in students %}
  <div class="page">

    <!-- Header -->
    <div class="header">
      <div class="header-left">
        {{ t.republic_en }}<br>
        <em>{{ t.motto_en }}</em><br>
        ***************<br>
        {{ t.ministry_en }}<br>
        ***************<br>
        {{ t.region_en }}<br>
        ***************<br>
        {{ t.school_en }}
      </div>
      <div class="header-logo">
        <img src="data:image/png;base64,{{ data.logo }}" alt="logo">
      </div>
      <div class="header-right">
        {{ t.republic_fr }}<br>
        <em>{{ t.motto_fr }}</em><br>
        ***************<br>
        {{ t.ministry_fr }}<br>
        ***************<br>
        {{ t.region_fr }}<br>
        ***************<br>
        {{ t.school_fr }}
      </div>
    </div>

    <!-- Title -->
    <div class="title">
      <strong>{{ data.term }} {{ t.term_report }}</strong><br>
      {{ t.school_year }}: 2025 / 2026
    </div>

    <!-- Student Info -->
    <div class="form-container">
      <div class="photo-box">
        {{ t.photo }}
      </div>
      <div class="form-table">
        <table class="form-table-inner">
          <tr>
            <td colspan="2"><strong><div class="subject">{{ t.student_name }} : {{ student.name }}</div></strong></td>
            <td><strong><div class="subject">{{ t.class }} : {{ data.class }}</div></strong></td>
          </tr>
          <tr>
            <td style="width: 40%;"><div class="subject">{{ t.dob }}:</div></td>
            <td style="width: 35%; padding-left: 20px;">{{ t.gender }}:</td>
            <td><div class="subject">{{ t.enrolment }} : {{ data.class_size }}</div></td>
          </tr>
          <tr>
            <td><div class="subject">{{ t.uin }}:</div></td>
            <td style="padding-left: 20px;">{{ t.repeater }}</td>
            <td><div class="subject">{{ t.num_subjects }} : {{ student.subjects|length }}</div></td>
          </tr>
          <tr>
            <td colspan="2" rowspan="4"><div class="subject">{{ t.guardian }}:</div></td>
            <td><div class="subject">{{ t.num_passed }} : {{ student.sub_passed }}</div></td>
          </tr>
          <tr>
            <td><div class="subject">{{ t.position }} : <strong>{{ student.rank }}</strong></div></td>
          </tr>
          <tr>
            <td class="class-master-cell"><div class="subject">{{ t.class_master }}:</div></td>
          </tr>
        </table>
      </div>
    </div>

    <!-- Subject Table -->
    <table>
      <thead>
        <tr>
          <th>{{ t.table_subjects }}</th>
          <th>{{ t.tt1 }}</th>
          <th>{{ t.tt2 }}</th>
          <th>{{ t.tt3 }}</th>
          <th>{{ t.av20 }}</th>
          <th>{{ t.coef }}</th>
          <th>{{ t.avxcoef }}</th>
          <th>{{ t.grade }}</th>
          <th>{{ t.minmax }}</th>
          <th>{{ t.remarks }}</th>
        </tr>
      </thead>
      <tbody>
        {% for subject in student.subjects %}
        <tr>
          <td rowspan="1"><div class="subject">{{ subject.name }}</div><div class="subject-m">{{ subject.teacher }}</div></td>
          <!-- <td style="text-align: left;">{{ subject.comp1 }}</td> -->
          <td>{{ subject.avg1 }}</td>
          <td>{{ subject.avg2 }}</td>
          <td>{{ subject.avg3 }}</td>
          <td rowspan="1">{{ subject.average }}</td>
          <td rowspan="1">{{ subject.coef }}</td>
          <td rowspan="1">{{ subject.weighted }}</td>
          <td rowspan="1">{{ subject.grade }}</td>
          <td rowspan="1">{{ subject.minAv }} - {{ subject.maxAv }}</td>
          <td rowspan="1">{{ subject.remark }}</td>
        </tr>
    
        {% endfor %}
        <tr>
          <td colspan="5" style="text-align: center; background-color: #DCDCDC;"><strong>
            {{ t.t1 }}: {{ student.t1Av }} | {{ t.t2 }}: {{ student.t2Av }} | {{ t.t3 }}: {{ student.t3Av }}
            </strong></td>
          <td>{{ student.total_coef }}</td>
          <td>{{ student.total_coefxAv }}</td>
          <td colspan="3"><strong>{{ t.a_avg }}: {{ "%.2f"|format(student.average) }}</strong></td>
        </tr>
      </tbody>
    </table>

    <!-- Summary Table -->
   <table class="summary-table">
  <thead>
    <tr>
      <th colspan="4">{{ t.discipline }}</th>
      <th colspan="4">{{ t.perf }}</th>
      <th colspan="2">{{ t.profile }}</th>
    </tr>
  </thead>
  <tbody>
    <!-- Row 1 -->
    <tr>
      <td class="tg-0pky">{{ t.unjust_abs }}</td>
      <td></td>
      <td class="tg-0pky">{{ t.conduct_warn }}</td>
      <td></td>

      <td class="tg-0pky">{{ t.total_score }}</td>
      <td>{{ student.total_coefxAv }}</td>
      <td class="tg-0pky" colspan="2">Class councel decision </td>

      <td class="tg-0pky">{{ t.class_avg }}</td>
      <td>{{ data.class_average|default('') }}</td>
    </tr>

    <!-- Row 2 -->
    <tr>
      <td class="tg-0pky" rowspan="2">{{ t.just_abs }}</td>
      <td rowspan="2"></td>
      <td class="tg-0pky" rowspan="2">{{ t.reprimand }}</td>
      <td rowspan="2"></td>

      <td class="tg-0pky" rowspan="2">{{ t.coef2 }}</td>
      <td rowspan="2">{{ student.total_coef }}</td>
      <td class="tg-0pky" rowspan="2">
        Promoted 
      </td>
      <td rowspan="2">
        {% if student.average >= 10 %}&#10003;{% endif %}
      </td>

      <td class="tg-0pky" rowspan="2">{{ t.minmax }}</td>
      <td rowspan="2">{{ data.last_average }} -<br>{{ data.first_average }}</td>
    </tr>

    <!-- Row 3 -->
    <tr></tr>

    <!-- Row 4 -->
    <tr>
      <td class="tg-0pky" rowspan="2">{{ t.late }}</td>
      <td rowspan="2">200</td>
      <td class="tg-0pky" rowspan="2">{{ t.suspension }}</td>
      <td rowspan="2"></td>

      <td class="tg-0pky" rowspan="2">{{ t.a_avg }}</td>
      <td rowspan="2">{{ student.average }}</td>
      <td class="tg-0pky" rowspan="2">
        Repeat 
      </td>
      <td rowspan="2">
        {% if student.average < 10 and student.average >= 6 %}&#10003;{% endif %}
      </td>

      <td class="tg-0pky" rowspan="2">{{ t.num_passed }}</td>
      <td rowspan="2">{{ data.stud_passed }}</td>
    </tr>

    <!-- Row 5 -->
    <tr></tr>

    <!-- Row 6 (CNA row restored) -->
    <tr>
      <td class="tg-0pky">{{ t.punish }}</td>
      <td></td>
      <td class="tg-0pky">{{ t.dismissed }}</td>
      <td></td>

      <td class="tg-0pky">{{ t.grade2 }}</td>
      <td>{{ student.grade }}</td>
      <td class="tg-0pky"> Dismissed for  </td>
      <td>{% if student.average < 6 %}&#10003;{% endif %}</td>

      <td class="tg-0pky">{{ t.success_rate }}</td>
      <td>{{ (data.stud_passed/data.class_size)*100 }}%</td>
    </tr>

    <!-- Remarks row -->
    <tr>
      <td colspan="4">{{ t.remarks_perf }}<br><br><p style="font-weight: bold;">{{ student.remark }}</p></td>
      <td colspan="2">{{ t.guardian_sign }}<br><br> <br><br></td>
      <td colspan="2">{{ t.master_sign }}<br><br> <br><br></td>
      <td colspan="2">{{ t.principal_sign }} <br><br><br><br></td>
    </tr>
  </tbody>
</table>




    <p style="text-align: right;"><br><br>{{ data.date }}</p>
  </div>
  {% endfor %}
</body>
</html>
